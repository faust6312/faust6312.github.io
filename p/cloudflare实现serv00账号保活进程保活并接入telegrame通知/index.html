<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="1.账号保活 由于ser00的账号3个月不ssh连接或者不登录网页面板的话账号就会被回收，故需要隔一段时间登录一下避免账号回收。这里使用的是cf wocker实现定时登录并接入telegrame-bot提示登录信息。 worker代码： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 addEventListener(&#39;fetch&#39;, event =&gt; { event.respondWith(handleRequest(event.request)) }) addEventListener(&#39;scheduled&#39;, event =&gt; { event.waitUntil(handleScheduled(event.scheduledTime)) }) async function handleRequest(request) { return new Response(&#39;Worker is running&#39;) } async function handleScheduled(scheduledTime) { const accounts = JSON.parse(ACCOUNTS_JSON) const results = await loginAccounts(accounts) await sendSummary(results) } async function loginAccounts(accounts) { const results = [] for (const account of accounts) { const result = await loginAccount(account) results.push({ ...account, ...result }) await delay(Math.floor(Math.random() * 8000) + 1000) } return results } function generateRandomUserAgent() { const browsers = [&#39;Chrome&#39;, &#39;Firefox&#39;, &#39;Safari&#39;, &#39;Edge&#39;, &#39;Opera&#39;]; const browser = browsers[Math.floor(Math.random() * browsers.length)]; const version = Math.floor(Math.random() * 100) + 1; const os = [&#39;Windows NT 10.0&#39;, &#39;Macintosh&#39;, &#39;X11&#39;]; const selectedOS = os[Math.floor(Math.random() * os.length)]; const osVersion = selectedOS === &#39;X11&#39; ? &#39;Linux x86_64&#39; : selectedOS === &#39;Macintosh&#39; ? &#39;Intel Mac OS X 10_15_7&#39; : &#39;Win64; x64&#39;; return `Mozilla/5.0 (${selectedOS}; ${osVersion}) AppleWebKit/537.36 (KHTML, like Gecko) ${browser}/${version}.0.0.0 Safari/537.36`; } async function loginAccount(account) { const { username, password, panelnum, type } = account let url = type === &#39;ct8&#39; ? &#39;https://panel.ct8.pl/login/?next=/&#39; : `https://panel${panelnum}.serv00.com/login/?next=/` const userAgent = generateRandomUserAgent(); try { const response = await fetch(url, { method: &#39;GET&#39;, headers: { &#39;User-Agent&#39;: userAgent, }, }) const pageContent = await response.text() const csrfMatch = pageContent.match(/name=&#34;csrfmiddlewaretoken&#34; value=&#34;([^&#34;]*)&#34;/) const csrfToken = csrfMatch ? csrfMatch[1] : null if (!csrfToken) { throw new Error(&#39;CSRF token not found&#39;) } const initialCookies = response.headers.get(&#39;set-cookie&#39;) || &#39;&#39; const formData = new URLSearchParams({ &#39;username&#39;: username, &#39;password&#39;: password, &#39;csrfmiddlewaretoken&#39;: csrfToken, &#39;next&#39;: &#39;/&#39; }) const loginResponse = await fetch(url, { method: &#39;POST&#39;, headers: { &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;, &#39;Referer&#39;: url, &#39;User-Agent&#39;: userAgent, &#39;Cookie&#39;: initialCookies, }, body: formData.toString(), redirect: &#39;manual&#39; }) console.log(`Login response status: ${loginResponse.status}`) console.log(`Login response headers: ${JSON.stringify(Object.fromEntries(loginResponse.headers))}`) const loginResponseBody = await loginResponse.text() console.log(`Login response body: ${loginResponseBody.substring(0, 200)}...`) if (loginResponse.status === 302 &amp;&amp; loginResponse.headers.get(&#39;location&#39;) === &#39;/&#39;) { const loginCookies = loginResponse.headers.get(&#39;set-cookie&#39;) || &#39;&#39; const allCookies = combineCookies(initialCookies, loginCookies) const dashboardResponse = await fetch(url.replace(&#39;/login/&#39;, &#39;/&#39;), { headers: { &#39;Cookie&#39;: allCookies, &#39;User-Agent&#39;: userAgent, } }) const dashboardContent = await dashboardResponse.text() console.log(`Dashboard content: ${dashboardContent.substring(0, 200)}...`) if (dashboardContent.includes(&#39;href=&#34;/logout/&#34;&#39;) || dashboardContent.includes(&#39;href=&#34;/wyloguj/&#34;&#39;)) { const nowUtc = formatToISO(new Date()) const nowBeijing = formatToISO(new Date(Date.now() + 8 * 60 * 60 * 1000)) const message = `账号 ${username} (${type}) 于北京时间 ${nowBeijing}（UTC时间 ${nowUtc}）登录成功！` console.log(message) await sendTelegramMessage(message) return { success: true, message } } else { const message = `账号 ${username} (${type}) 登录后未找到登出链接，可能登录失败。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } else if (loginResponseBody.includes(&#39;Nieprawidłowy login lub hasło&#39;)) { const message = `账号 ${username} (${type}) 登录失败：用户名或密码错误。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } else { const message = `账号 ${username} (${type}) 登录失败，未知原因。请检查账号和密码是否正确。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } catch (error) { const message = `账号 ${username} (${type}) 登录时出现错误: ${error.message}` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } function combineCookies(cookies1, cookies2) { const cookieMap = new Map() const parseCookies = (cookieString) =&gt; { cookieString.split(&#39;,&#39;).forEach(cookie =&gt; { const [fullCookie] = cookie.trim().split(&#39;;&#39;) const [name, value] = fullCookie.split(&#39;=&#39;) if (name &amp;&amp; value) { cookieMap.set(name.trim(), value.trim()) } }) } parseCookies(cookies1) parseCookies(cookies2) return Array.from(cookieMap.entries()).map(([name, value]) =&gt; `${name}=${value}`).join(&#39;; &#39;) } async function sendSummary(results) { const successfulLogins = results.filter(r =&gt; r.success) const failedLogins = results.filter(r =&gt; !r.success) let summaryMessage = &#39;登录结果统计：\\n&#39; summaryMessage += `成功登录的账号：${successfulLogins.length}\\n` summaryMessage += `登录失败的账号：${failedLogins.length}\\n` if (failedLogins.length &gt; 0) { summaryMessage += &#39;\\n登录失败的账号列表：\\n&#39; failedLogins.forEach(({ username, type, message }) =&gt; { summaryMessage += `- ${username} (${type}): ${message}\\n` }) } console.log(summaryMessage) await sendTelegramMessage(summaryMessage) } async function sendTelegramMessage(message) { const telegramConfig = JSON.parse(TELEGRAM_JSON) const { telegramBotToken, telegramBotUserId } = telegramConfig const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage` try { await fetch(url, { method: &#39;POST&#39;, headers: { &#39;Content-Type&#39;: &#39;application/json&#39; }, body: JSON.stringify({ chat_id: telegramBotUserId, text: message }) }) } catch (error) { console.error(&#39;Error sending Telegram message:&#39;, error) } } function formatToISO(date) { return date.toISOString().replace(&#39;T&#39;, &#39; &#39;).replace(&#39;Z&#39;, &#39;&#39;).replace(/\\.\\d{3}Z/, &#39;&#39;) } function delay(ms) { return new Promise(resolve =&gt; setTimeout(resolve, ms)) } 变量： ACCOUNTS_JSON 1 2 3 4 5 6 7 [ { &#34;username&#34;: &#34;serv00user1&#34;, &#34;password&#34;: &#34;serv00password1&#34;, &#34;panelnum&#34;: &#34;0&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;serv00user2&#34;, &#34;password&#34;: &#34;serv00password2&#34;, &#34;panelnum&#34;: &#34;4&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;serv00user3&#34;, &#34;password&#34;: &#34;serv00password3&#34;, &#34;panelnum&#34;: &#34;7&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;ct8user1&#34;, &#34;password&#34;: &#34;ct8password1&#34;, &#34;type&#34;: &#34;ct8&#34; }, { &#34;username&#34;: &#34;ct8user2&#34;, &#34;password&#34;: &#34;ct8password2&#34;, &#34;type&#34;: &#34;ct8&#34; } ] TELEGRAM_JSON 1 2 3 4 { &#34;telegramBotToken&#34;: &#34;YOUR_BOT_TOKEN&#34;, &#34;telegramBotUserId&#34;: &#34;YOUR_USER_ID&#34; } ">
<title>CloudFlare实现Serv00账号保活&amp;进程保活并接入telegrame通知</title>

<link rel='canonical' href='https://faust6312.github.io/p/cloudflare%E5%AE%9E%E7%8E%B0serv00%E8%B4%A6%E5%8F%B7%E4%BF%9D%E6%B4%BB%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%B4%BB%E5%B9%B6%E6%8E%A5%E5%85%A5telegrame%E9%80%9A%E7%9F%A5/'>

<link rel="stylesheet" href="/scss/style.min.22177a8f092cfc73d414a4a426298df2114028fe83666f630462b9c65370154f.css"><meta property='og:title' content="CloudFlare实现Serv00账号保活&进程保活并接入telegrame通知">
<meta property='og:description' content="1.账号保活 由于ser00的账号3个月不ssh连接或者不登录网页面板的话账号就会被回收，故需要隔一段时间登录一下避免账号回收。这里使用的是cf wocker实现定时登录并接入telegrame-bot提示登录信息。 worker代码： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 addEventListener(&#39;fetch&#39;, event =&gt; { event.respondWith(handleRequest(event.request)) }) addEventListener(&#39;scheduled&#39;, event =&gt; { event.waitUntil(handleScheduled(event.scheduledTime)) }) async function handleRequest(request) { return new Response(&#39;Worker is running&#39;) } async function handleScheduled(scheduledTime) { const accounts = JSON.parse(ACCOUNTS_JSON) const results = await loginAccounts(accounts) await sendSummary(results) } async function loginAccounts(accounts) { const results = [] for (const account of accounts) { const result = await loginAccount(account) results.push({ ...account, ...result }) await delay(Math.floor(Math.random() * 8000) + 1000) } return results } function generateRandomUserAgent() { const browsers = [&#39;Chrome&#39;, &#39;Firefox&#39;, &#39;Safari&#39;, &#39;Edge&#39;, &#39;Opera&#39;]; const browser = browsers[Math.floor(Math.random() * browsers.length)]; const version = Math.floor(Math.random() * 100) + 1; const os = [&#39;Windows NT 10.0&#39;, &#39;Macintosh&#39;, &#39;X11&#39;]; const selectedOS = os[Math.floor(Math.random() * os.length)]; const osVersion = selectedOS === &#39;X11&#39; ? &#39;Linux x86_64&#39; : selectedOS === &#39;Macintosh&#39; ? &#39;Intel Mac OS X 10_15_7&#39; : &#39;Win64; x64&#39;; return `Mozilla/5.0 (${selectedOS}; ${osVersion}) AppleWebKit/537.36 (KHTML, like Gecko) ${browser}/${version}.0.0.0 Safari/537.36`; } async function loginAccount(account) { const { username, password, panelnum, type } = account let url = type === &#39;ct8&#39; ? &#39;https://panel.ct8.pl/login/?next=/&#39; : `https://panel${panelnum}.serv00.com/login/?next=/` const userAgent = generateRandomUserAgent(); try { const response = await fetch(url, { method: &#39;GET&#39;, headers: { &#39;User-Agent&#39;: userAgent, }, }) const pageContent = await response.text() const csrfMatch = pageContent.match(/name=&#34;csrfmiddlewaretoken&#34; value=&#34;([^&#34;]*)&#34;/) const csrfToken = csrfMatch ? csrfMatch[1] : null if (!csrfToken) { throw new Error(&#39;CSRF token not found&#39;) } const initialCookies = response.headers.get(&#39;set-cookie&#39;) || &#39;&#39; const formData = new URLSearchParams({ &#39;username&#39;: username, &#39;password&#39;: password, &#39;csrfmiddlewaretoken&#39;: csrfToken, &#39;next&#39;: &#39;/&#39; }) const loginResponse = await fetch(url, { method: &#39;POST&#39;, headers: { &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;, &#39;Referer&#39;: url, &#39;User-Agent&#39;: userAgent, &#39;Cookie&#39;: initialCookies, }, body: formData.toString(), redirect: &#39;manual&#39; }) console.log(`Login response status: ${loginResponse.status}`) console.log(`Login response headers: ${JSON.stringify(Object.fromEntries(loginResponse.headers))}`) const loginResponseBody = await loginResponse.text() console.log(`Login response body: ${loginResponseBody.substring(0, 200)}...`) if (loginResponse.status === 302 &amp;&amp; loginResponse.headers.get(&#39;location&#39;) === &#39;/&#39;) { const loginCookies = loginResponse.headers.get(&#39;set-cookie&#39;) || &#39;&#39; const allCookies = combineCookies(initialCookies, loginCookies) const dashboardResponse = await fetch(url.replace(&#39;/login/&#39;, &#39;/&#39;), { headers: { &#39;Cookie&#39;: allCookies, &#39;User-Agent&#39;: userAgent, } }) const dashboardContent = await dashboardResponse.text() console.log(`Dashboard content: ${dashboardContent.substring(0, 200)}...`) if (dashboardContent.includes(&#39;href=&#34;/logout/&#34;&#39;) || dashboardContent.includes(&#39;href=&#34;/wyloguj/&#34;&#39;)) { const nowUtc = formatToISO(new Date()) const nowBeijing = formatToISO(new Date(Date.now() + 8 * 60 * 60 * 1000)) const message = `账号 ${username} (${type}) 于北京时间 ${nowBeijing}（UTC时间 ${nowUtc}）登录成功！` console.log(message) await sendTelegramMessage(message) return { success: true, message } } else { const message = `账号 ${username} (${type}) 登录后未找到登出链接，可能登录失败。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } else if (loginResponseBody.includes(&#39;Nieprawidłowy login lub hasło&#39;)) { const message = `账号 ${username} (${type}) 登录失败：用户名或密码错误。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } else { const message = `账号 ${username} (${type}) 登录失败，未知原因。请检查账号和密码是否正确。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } catch (error) { const message = `账号 ${username} (${type}) 登录时出现错误: ${error.message}` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } function combineCookies(cookies1, cookies2) { const cookieMap = new Map() const parseCookies = (cookieString) =&gt; { cookieString.split(&#39;,&#39;).forEach(cookie =&gt; { const [fullCookie] = cookie.trim().split(&#39;;&#39;) const [name, value] = fullCookie.split(&#39;=&#39;) if (name &amp;&amp; value) { cookieMap.set(name.trim(), value.trim()) } }) } parseCookies(cookies1) parseCookies(cookies2) return Array.from(cookieMap.entries()).map(([name, value]) =&gt; `${name}=${value}`).join(&#39;; &#39;) } async function sendSummary(results) { const successfulLogins = results.filter(r =&gt; r.success) const failedLogins = results.filter(r =&gt; !r.success) let summaryMessage = &#39;登录结果统计：\\n&#39; summaryMessage += `成功登录的账号：${successfulLogins.length}\\n` summaryMessage += `登录失败的账号：${failedLogins.length}\\n` if (failedLogins.length &gt; 0) { summaryMessage += &#39;\\n登录失败的账号列表：\\n&#39; failedLogins.forEach(({ username, type, message }) =&gt; { summaryMessage += `- ${username} (${type}): ${message}\\n` }) } console.log(summaryMessage) await sendTelegramMessage(summaryMessage) } async function sendTelegramMessage(message) { const telegramConfig = JSON.parse(TELEGRAM_JSON) const { telegramBotToken, telegramBotUserId } = telegramConfig const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage` try { await fetch(url, { method: &#39;POST&#39;, headers: { &#39;Content-Type&#39;: &#39;application/json&#39; }, body: JSON.stringify({ chat_id: telegramBotUserId, text: message }) }) } catch (error) { console.error(&#39;Error sending Telegram message:&#39;, error) } } function formatToISO(date) { return date.toISOString().replace(&#39;T&#39;, &#39; &#39;).replace(&#39;Z&#39;, &#39;&#39;).replace(/\\.\\d{3}Z/, &#39;&#39;) } function delay(ms) { return new Promise(resolve =&gt; setTimeout(resolve, ms)) } 变量： ACCOUNTS_JSON 1 2 3 4 5 6 7 [ { &#34;username&#34;: &#34;serv00user1&#34;, &#34;password&#34;: &#34;serv00password1&#34;, &#34;panelnum&#34;: &#34;0&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;serv00user2&#34;, &#34;password&#34;: &#34;serv00password2&#34;, &#34;panelnum&#34;: &#34;4&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;serv00user3&#34;, &#34;password&#34;: &#34;serv00password3&#34;, &#34;panelnum&#34;: &#34;7&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;ct8user1&#34;, &#34;password&#34;: &#34;ct8password1&#34;, &#34;type&#34;: &#34;ct8&#34; }, { &#34;username&#34;: &#34;ct8user2&#34;, &#34;password&#34;: &#34;ct8password2&#34;, &#34;type&#34;: &#34;ct8&#34; } ] TELEGRAM_JSON 1 2 3 4 { &#34;telegramBotToken&#34;: &#34;YOUR_BOT_TOKEN&#34;, &#34;telegramBotUserId&#34;: &#34;YOUR_USER_ID&#34; } ">
<meta property='og:url' content='https://faust6312.github.io/p/cloudflare%E5%AE%9E%E7%8E%B0serv00%E8%B4%A6%E5%8F%B7%E4%BF%9D%E6%B4%BB%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%B4%BB%E5%B9%B6%E6%8E%A5%E5%85%A5telegrame%E9%80%9A%E7%9F%A5/'>
<meta property='og:site_name' content='cheems'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-12-12T17:52:58&#43;08:00'/><meta property='article:modified_time' content='2024-12-12T10:37:27&#43;00:00'/><meta property='og:image' content='https://roim-picx-9nr.pages.dev/rest/opJqrLK.png' />
<meta name="twitter:title" content="CloudFlare实现Serv00账号保活&进程保活并接入telegrame通知">
<meta name="twitter:description" content="1.账号保活 由于ser00的账号3个月不ssh连接或者不登录网页面板的话账号就会被回收，故需要隔一段时间登录一下避免账号回收。这里使用的是cf wocker实现定时登录并接入telegrame-bot提示登录信息。 worker代码： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 addEventListener(&#39;fetch&#39;, event =&gt; { event.respondWith(handleRequest(event.request)) }) addEventListener(&#39;scheduled&#39;, event =&gt; { event.waitUntil(handleScheduled(event.scheduledTime)) }) async function handleRequest(request) { return new Response(&#39;Worker is running&#39;) } async function handleScheduled(scheduledTime) { const accounts = JSON.parse(ACCOUNTS_JSON) const results = await loginAccounts(accounts) await sendSummary(results) } async function loginAccounts(accounts) { const results = [] for (const account of accounts) { const result = await loginAccount(account) results.push({ ...account, ...result }) await delay(Math.floor(Math.random() * 8000) + 1000) } return results } function generateRandomUserAgent() { const browsers = [&#39;Chrome&#39;, &#39;Firefox&#39;, &#39;Safari&#39;, &#39;Edge&#39;, &#39;Opera&#39;]; const browser = browsers[Math.floor(Math.random() * browsers.length)]; const version = Math.floor(Math.random() * 100) + 1; const os = [&#39;Windows NT 10.0&#39;, &#39;Macintosh&#39;, &#39;X11&#39;]; const selectedOS = os[Math.floor(Math.random() * os.length)]; const osVersion = selectedOS === &#39;X11&#39; ? &#39;Linux x86_64&#39; : selectedOS === &#39;Macintosh&#39; ? &#39;Intel Mac OS X 10_15_7&#39; : &#39;Win64; x64&#39;; return `Mozilla/5.0 (${selectedOS}; ${osVersion}) AppleWebKit/537.36 (KHTML, like Gecko) ${browser}/${version}.0.0.0 Safari/537.36`; } async function loginAccount(account) { const { username, password, panelnum, type } = account let url = type === &#39;ct8&#39; ? &#39;https://panel.ct8.pl/login/?next=/&#39; : `https://panel${panelnum}.serv00.com/login/?next=/` const userAgent = generateRandomUserAgent(); try { const response = await fetch(url, { method: &#39;GET&#39;, headers: { &#39;User-Agent&#39;: userAgent, }, }) const pageContent = await response.text() const csrfMatch = pageContent.match(/name=&#34;csrfmiddlewaretoken&#34; value=&#34;([^&#34;]*)&#34;/) const csrfToken = csrfMatch ? csrfMatch[1] : null if (!csrfToken) { throw new Error(&#39;CSRF token not found&#39;) } const initialCookies = response.headers.get(&#39;set-cookie&#39;) || &#39;&#39; const formData = new URLSearchParams({ &#39;username&#39;: username, &#39;password&#39;: password, &#39;csrfmiddlewaretoken&#39;: csrfToken, &#39;next&#39;: &#39;/&#39; }) const loginResponse = await fetch(url, { method: &#39;POST&#39;, headers: { &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;, &#39;Referer&#39;: url, &#39;User-Agent&#39;: userAgent, &#39;Cookie&#39;: initialCookies, }, body: formData.toString(), redirect: &#39;manual&#39; }) console.log(`Login response status: ${loginResponse.status}`) console.log(`Login response headers: ${JSON.stringify(Object.fromEntries(loginResponse.headers))}`) const loginResponseBody = await loginResponse.text() console.log(`Login response body: ${loginResponseBody.substring(0, 200)}...`) if (loginResponse.status === 302 &amp;&amp; loginResponse.headers.get(&#39;location&#39;) === &#39;/&#39;) { const loginCookies = loginResponse.headers.get(&#39;set-cookie&#39;) || &#39;&#39; const allCookies = combineCookies(initialCookies, loginCookies) const dashboardResponse = await fetch(url.replace(&#39;/login/&#39;, &#39;/&#39;), { headers: { &#39;Cookie&#39;: allCookies, &#39;User-Agent&#39;: userAgent, } }) const dashboardContent = await dashboardResponse.text() console.log(`Dashboard content: ${dashboardContent.substring(0, 200)}...`) if (dashboardContent.includes(&#39;href=&#34;/logout/&#34;&#39;) || dashboardContent.includes(&#39;href=&#34;/wyloguj/&#34;&#39;)) { const nowUtc = formatToISO(new Date()) const nowBeijing = formatToISO(new Date(Date.now() + 8 * 60 * 60 * 1000)) const message = `账号 ${username} (${type}) 于北京时间 ${nowBeijing}（UTC时间 ${nowUtc}）登录成功！` console.log(message) await sendTelegramMessage(message) return { success: true, message } } else { const message = `账号 ${username} (${type}) 登录后未找到登出链接，可能登录失败。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } else if (loginResponseBody.includes(&#39;Nieprawidłowy login lub hasło&#39;)) { const message = `账号 ${username} (${type}) 登录失败：用户名或密码错误。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } else { const message = `账号 ${username} (${type}) 登录失败，未知原因。请检查账号和密码是否正确。` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } catch (error) { const message = `账号 ${username} (${type}) 登录时出现错误: ${error.message}` console.error(message) await sendTelegramMessage(message) return { success: false, message } } } function combineCookies(cookies1, cookies2) { const cookieMap = new Map() const parseCookies = (cookieString) =&gt; { cookieString.split(&#39;,&#39;).forEach(cookie =&gt; { const [fullCookie] = cookie.trim().split(&#39;;&#39;) const [name, value] = fullCookie.split(&#39;=&#39;) if (name &amp;&amp; value) { cookieMap.set(name.trim(), value.trim()) } }) } parseCookies(cookies1) parseCookies(cookies2) return Array.from(cookieMap.entries()).map(([name, value]) =&gt; `${name}=${value}`).join(&#39;; &#39;) } async function sendSummary(results) { const successfulLogins = results.filter(r =&gt; r.success) const failedLogins = results.filter(r =&gt; !r.success) let summaryMessage = &#39;登录结果统计：\\n&#39; summaryMessage += `成功登录的账号：${successfulLogins.length}\\n` summaryMessage += `登录失败的账号：${failedLogins.length}\\n` if (failedLogins.length &gt; 0) { summaryMessage += &#39;\\n登录失败的账号列表：\\n&#39; failedLogins.forEach(({ username, type, message }) =&gt; { summaryMessage += `- ${username} (${type}): ${message}\\n` }) } console.log(summaryMessage) await sendTelegramMessage(summaryMessage) } async function sendTelegramMessage(message) { const telegramConfig = JSON.parse(TELEGRAM_JSON) const { telegramBotToken, telegramBotUserId } = telegramConfig const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage` try { await fetch(url, { method: &#39;POST&#39;, headers: { &#39;Content-Type&#39;: &#39;application/json&#39; }, body: JSON.stringify({ chat_id: telegramBotUserId, text: message }) }) } catch (error) { console.error(&#39;Error sending Telegram message:&#39;, error) } } function formatToISO(date) { return date.toISOString().replace(&#39;T&#39;, &#39; &#39;).replace(&#39;Z&#39;, &#39;&#39;).replace(/\\.\\d{3}Z/, &#39;&#39;) } function delay(ms) { return new Promise(resolve =&gt; setTimeout(resolve, ms)) } 变量： ACCOUNTS_JSON 1 2 3 4 5 6 7 [ { &#34;username&#34;: &#34;serv00user1&#34;, &#34;password&#34;: &#34;serv00password1&#34;, &#34;panelnum&#34;: &#34;0&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;serv00user2&#34;, &#34;password&#34;: &#34;serv00password2&#34;, &#34;panelnum&#34;: &#34;4&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;serv00user3&#34;, &#34;password&#34;: &#34;serv00password3&#34;, &#34;panelnum&#34;: &#34;7&#34;, &#34;type&#34;: &#34;serv00&#34; }, { &#34;username&#34;: &#34;ct8user1&#34;, &#34;password&#34;: &#34;ct8password1&#34;, &#34;type&#34;: &#34;ct8&#34; }, { &#34;username&#34;: &#34;ct8user2&#34;, &#34;password&#34;: &#34;ct8password2&#34;, &#34;type&#34;: &#34;ct8&#34; } ] TELEGRAM_JSON 1 2 3 4 { &#34;telegramBotToken&#34;: &#34;YOUR_BOT_TOKEN&#34;, &#34;telegramBotUserId&#34;: &#34;YOUR_USER_ID&#34; } "><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://roim-picx-9nr.pages.dev/rest/opJqrLK.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/Fuukei/Public_Repository@0.9.3/static/js/sakura-less.js"></script>
        <div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu3167158562562984115.png" width="300"
                            height="322" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">cheems</a></h1>
            <h2 class="site-description">Silence wench,I do not wish to be horny anymore, I just want to be happy.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/237593169'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.cnblogs.com/faust6312'
                        target="_blank"
                        title="Blogyuan"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-blogger"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 21h8a5 5 0 0 0 5 -5v-3a3 3 0 0 0 -3 -3h-1v-2a5 5 0 0 0 -5 -5h-4a5 5 0 0 0 -5 5v8a5 5 0 0 0 5 5z" /><path d="M7 7m0 1.5a1.5 1.5 0 0 1 1.5 -1.5h3a1.5 1.5 0 0 1 1.5 1.5v0a1.5 1.5 0 0 1 -1.5 1.5h-3a1.5 1.5 0 0 1 -1.5 -1.5z" /><path d="M7 14m0 1.5a1.5 1.5 0 0 1 1.5 -1.5h7a1.5 1.5 0 0 1 1.5 1.5v0a1.5 1.5 0 0 1 -1.5 1.5h-7a1.5 1.5 0 0 1 -1.5 -1.5z" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/faust6312'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/cloudflare%E5%AE%9E%E7%8E%B0serv00%E8%B4%A6%E5%8F%B7%E4%BF%9D%E6%B4%BB%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%B4%BB%E5%B9%B6%E6%8E%A5%E5%85%A5telegrame%E9%80%9A%E7%9F%A5/">
                
                    <img src="https://roim-picx-9nr.pages.dev/rest/opJqrLK.png" loading="lazy" alt="Featured image of post CloudFlare实现Serv00账号保活&amp;进程保活并接入telegrame通知" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/serv00/" >
                Serv00
            </a>
        
            <a href="/categories/cloudflare/" >
                CloudFlare
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/cloudflare%E5%AE%9E%E7%8E%B0serv00%E8%B4%A6%E5%8F%B7%E4%BF%9D%E6%B4%BB%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%B4%BB%E5%B9%B6%E6%8E%A5%E5%85%A5telegrame%E9%80%9A%E7%9F%A5/">CloudFlare实现Serv00账号保活&amp;进程保活并接入telegrame通知</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-12-12</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="1账号保活">1.账号保活
</h1><ul>
<li>由于ser00的账号3个月不ssh连接或者不登录网页面板的话账号就会被回收，故需要隔一段时间登录一下避免账号回收。这里使用的是cf wocker实现定时登录并接入telegrame-bot提示登录信息。</li>
<li>worker代码：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">addEventListener</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span> <span class="n">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">event</span><span class="o">.</span><span class="n">respondWith</span><span class="p">(</span><span class="n">handleRequest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">request</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">addEventListener</span><span class="p">(</span><span class="s1">&#39;scheduled&#39;</span><span class="p">,</span> <span class="n">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">event</span><span class="o">.</span><span class="n">waitUntil</span><span class="p">(</span><span class="n">handleScheduled</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scheduledTime</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">handleRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Worker is running&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">handleScheduled</span><span class="p">(</span><span class="n">scheduledTime</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ACCOUNTS_JSON</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">results</span> <span class="o">=</span> <span class="n">await</span> <span class="n">loginAccounts</span><span class="p">(</span><span class="n">accounts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">await</span> <span class="n">sendSummary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">loginAccounts</span><span class="p">(</span><span class="n">accounts</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">account</span> <span class="n">of</span> <span class="n">accounts</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">result</span> <span class="o">=</span> <span class="n">await</span> <span class="n">loginAccount</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span><span class="o">.</span><span class="n">push</span><span class="p">({</span> <span class="o">...</span><span class="n">account</span><span class="p">,</span> <span class="o">...</span><span class="n">result</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">await</span> <span class="n">delay</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">8000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">generateRandomUserAgent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">browsers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Chrome&#39;</span><span class="p">,</span> <span class="s1">&#39;Firefox&#39;</span><span class="p">,</span> <span class="s1">&#39;Safari&#39;</span><span class="p">,</span> <span class="s1">&#39;Edge&#39;</span><span class="p">,</span> <span class="s1">&#39;Opera&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">browser</span> <span class="o">=</span> <span class="n">browsers</span><span class="p">[</span><span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">browsers</span><span class="o">.</span><span class="n">length</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">version</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Windows NT 10.0&#39;</span><span class="p">,</span> <span class="s1">&#39;Macintosh&#39;</span><span class="p">,</span> <span class="s1">&#39;X11&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">selectedOS</span> <span class="o">=</span> <span class="n">os</span><span class="p">[</span><span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">os</span><span class="o">.</span><span class="n">length</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">osVersion</span> <span class="o">=</span> <span class="n">selectedOS</span> <span class="o">===</span> <span class="s1">&#39;X11&#39;</span> <span class="err">?</span> <span class="s1">&#39;Linux x86_64&#39;</span> <span class="p">:</span> <span class="n">selectedOS</span> <span class="o">===</span> <span class="s1">&#39;Macintosh&#39;</span> <span class="err">?</span> <span class="s1">&#39;Intel Mac OS X 10_15_7&#39;</span> <span class="p">:</span> <span class="s1">&#39;Win64; x64&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="err">`</span><span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">selectedOS</span><span class="p">};</span> <span class="o">$</span><span class="p">{</span><span class="n">osVersion</span><span class="p">})</span> <span class="n">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span> <span class="p">(</span><span class="n">KHTML</span><span class="p">,</span> <span class="n">like</span> <span class="n">Gecko</span><span class="p">)</span> <span class="o">$</span><span class="p">{</span><span class="n">browser</span><span class="p">}</span><span class="o">/$</span><span class="p">{</span><span class="n">version</span><span class="p">}</span><span class="o">.</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">0</span> <span class="n">Safari</span><span class="o">/</span><span class="mf">537.36</span><span class="err">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">loginAccount</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="p">{</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">panelnum</span><span class="p">,</span> <span class="n">type</span> <span class="p">}</span> <span class="o">=</span> <span class="n">account</span>
</span></span><span class="line"><span class="cl">  <span class="n">let</span> <span class="n">url</span> <span class="o">=</span> <span class="n">type</span> <span class="o">===</span> <span class="s1">&#39;ct8&#39;</span> 
</span></span><span class="line"><span class="cl">    <span class="err">?</span> <span class="s1">&#39;https://panel.ct8.pl/login/?next=/&#39;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">:</span> <span class="err">`</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">panel</span><span class="o">$</span><span class="p">{</span><span class="n">panelnum</span><span class="p">}</span><span class="o">.</span><span class="n">serv00</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">login</span><span class="o">/</span><span class="err">?</span><span class="n">next</span><span class="o">=/</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">userAgent</span> <span class="o">=</span> <span class="n">generateRandomUserAgent</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">response</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">pageContent</span> <span class="o">=</span> <span class="n">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">csrfMatch</span> <span class="o">=</span> <span class="n">pageContent</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="o">/</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;csrfmiddlewaretoken&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&#34;([^&#34;</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="s2">&#34;/)</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">csrfToken</span> <span class="o">=</span> <span class="n">csrfMatch</span> <span class="err">?</span> <span class="n">csrfMatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">csrfToken</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">throw</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;CSRF token not found&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">initialCookies</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set-cookie&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">formData</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URLSearchParams</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;csrfmiddlewaretoken&#39;</span><span class="p">:</span> <span class="n">csrfToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;next&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">loginResponse</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="n">initialCookies</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="n">body</span><span class="p">:</span> <span class="n">formData</span><span class="o">.</span><span class="n">toString</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">      <span class="n">redirect</span><span class="p">:</span> <span class="s1">&#39;manual&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Login</span> <span class="n">response</span> <span class="n">status</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">loginResponse</span><span class="o">.</span><span class="n">status</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Login</span> <span class="n">response</span> <span class="n">headers</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="ne">Object</span><span class="o">.</span><span class="n">fromEntries</span><span class="p">(</span><span class="n">loginResponse</span><span class="o">.</span><span class="n">headers</span><span class="p">))}</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">loginResponseBody</span> <span class="o">=</span> <span class="n">await</span> <span class="n">loginResponse</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Login</span> <span class="n">response</span> <span class="n">body</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">loginResponseBody</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)}</span><span class="o">...</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">loginResponse</span><span class="o">.</span><span class="n">status</span> <span class="o">===</span> <span class="mi">302</span> <span class="o">&amp;&amp;</span> <span class="n">loginResponse</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">loginCookies</span> <span class="o">=</span> <span class="n">loginResponse</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set-cookie&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">allCookies</span> <span class="o">=</span> <span class="n">combineCookies</span><span class="p">(</span><span class="n">initialCookies</span><span class="p">,</span> <span class="n">loginCookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">dashboardResponse</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/login/&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="n">allCookies</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">dashboardContent</span> <span class="o">=</span> <span class="n">await</span> <span class="n">dashboardResponse</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Dashboard</span> <span class="n">content</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">dashboardContent</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)}</span><span class="o">...</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">dashboardContent</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="s1">&#39;href=&#34;/logout/&#34;&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="n">dashboardContent</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="s1">&#39;href=&#34;/wyloguj/&#34;&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">nowUtc</span> <span class="o">=</span> <span class="n">formatToISO</span><span class="p">(</span><span class="n">new</span> <span class="n">Date</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">nowBeijing</span> <span class="o">=</span> <span class="n">formatToISO</span><span class="p">(</span><span class="n">new</span> <span class="n">Date</span><span class="p">(</span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`账号</span> <span class="o">$</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">type</span><span class="p">})</span> <span class="err">于北京时间</span> <span class="o">$</span><span class="p">{</span><span class="n">nowBeijing</span><span class="p">}</span><span class="err">（</span><span class="n">UTC时间</span> <span class="o">$</span><span class="p">{</span><span class="n">nowUtc</span><span class="p">}</span><span class="err">）登录成功！`</span>
</span></span><span class="line"><span class="cl">        <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">await</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">true</span><span class="p">,</span> <span class="n">message</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`账号</span> <span class="o">$</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">type</span><span class="p">})</span> <span class="err">登录后未找到登出链接，可能登录失败。`</span>
</span></span><span class="line"><span class="cl">        <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">await</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span> <span class="n">message</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">loginResponseBody</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="s1">&#39;Nieprawidłowy login lub hasło&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`账号</span> <span class="o">$</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">type</span><span class="p">})</span> <span class="err">登录失败：用户名或密码错误。`</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">await</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span> <span class="n">message</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`账号</span> <span class="o">$</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">type</span><span class="p">})</span> <span class="err">登录失败，未知原因。请检查账号和密码是否正确。`</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">await</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span> <span class="n">message</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`账号</span> <span class="o">$</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">type</span><span class="p">})</span> <span class="err">登录时出现错误</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">}</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">await</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span> <span class="n">message</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">combineCookies</span><span class="p">(</span><span class="n">cookies1</span><span class="p">,</span> <span class="n">cookies2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">cookieMap</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Map</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">parseCookies</span> <span class="o">=</span> <span class="p">(</span><span class="n">cookieString</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookieString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">cookie</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="p">[</span><span class="n">fullCookie</span><span class="p">]</span> <span class="o">=</span> <span class="n">cookie</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullCookie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cookieMap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">trim</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">trim</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">parseCookies</span><span class="p">(</span><span class="n">cookies1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">parseCookies</span><span class="p">(</span><span class="n">cookies2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="ne">Array</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">cookieMap</span><span class="o">.</span><span class="n">entries</span><span class="p">())</span><span class="o">.</span><span class="n">map</span><span class="p">(([</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="err">`</span><span class="o">$</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="o">=$</span><span class="p">{</span><span class="n">value</span><span class="p">}</span><span class="err">`</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">sendSummary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">successfulLogins</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">r</span> <span class="o">=&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">failedLogins</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">r</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="n">r</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">let</span> <span class="n">summaryMessage</span> <span class="o">=</span> <span class="s1">&#39;登录结果统计：</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="n">summaryMessage</span> <span class="o">+=</span> <span class="err">`成功登录的账号：</span><span class="o">$</span><span class="p">{</span><span class="n">successfulLogins</span><span class="o">.</span><span class="n">length</span><span class="p">}</span>\<span class="n">n</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">  <span class="n">summaryMessage</span> <span class="o">+=</span> <span class="err">`登录失败的账号：</span><span class="o">$</span><span class="p">{</span><span class="n">failedLogins</span><span class="o">.</span><span class="n">length</span><span class="p">}</span>\<span class="n">n</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">failedLogins</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">summaryMessage</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">登录失败的账号列表：</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">failedLogins</span><span class="o">.</span><span class="n">forEach</span><span class="p">(({</span> <span class="n">username</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">message</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">summaryMessage</span> <span class="o">+=</span> <span class="err">`</span><span class="o">-</span> <span class="o">$</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">type</span><span class="p">}):</span> <span class="o">$</span><span class="p">{</span><span class="n">message</span><span class="p">}</span>\<span class="n">n</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">summaryMessage</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">await</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="n">summaryMessage</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">telegramConfig</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">TELEGRAM_JSON</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="p">{</span> <span class="n">telegramBotToken</span><span class="p">,</span> <span class="n">telegramBotUserId</span> <span class="p">}</span> <span class="o">=</span> <span class="n">telegramConfig</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">url</span> <span class="o">=</span> <span class="err">`</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">telegram</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">bot</span><span class="o">$</span><span class="p">{</span><span class="n">telegramBotToken</span><span class="p">}</span><span class="o">/</span><span class="n">sendMessage</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="n">body</span><span class="p">:</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="n">chat_id</span><span class="p">:</span> <span class="n">telegramBotUserId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span><span class="p">:</span> <span class="n">message</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error sending Telegram message:&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">formatToISO</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">date</span><span class="o">.</span><span class="n">toISOString</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span>\<span class="o">.</span>\<span class="n">d</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="n">Z</span><span class="o">/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">delay</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">new</span> <span class="n">Promise</span><span class="p">(</span><span class="n">resolve</span> <span class="o">=&gt;</span> <span class="n">setTimeout</span><span class="p">(</span><span class="n">resolve</span><span class="p">,</span> <span class="n">ms</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>变量：</li>
<li>ACCOUNTS_JSON</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[  
</span></span><span class="line"><span class="cl">  { &#34;username&#34;: &#34;serv00user1&#34;, &#34;password&#34;: &#34;serv00password1&#34;, &#34;panelnum&#34;: &#34;0&#34;, &#34;type&#34;: &#34;serv00&#34; },
</span></span><span class="line"><span class="cl">  { &#34;username&#34;: &#34;serv00user2&#34;, &#34;password&#34;: &#34;serv00password2&#34;, &#34;panelnum&#34;: &#34;4&#34;, &#34;type&#34;: &#34;serv00&#34; },
</span></span><span class="line"><span class="cl">  { &#34;username&#34;: &#34;serv00user3&#34;, &#34;password&#34;: &#34;serv00password3&#34;, &#34;panelnum&#34;: &#34;7&#34;, &#34;type&#34;: &#34;serv00&#34; },
</span></span><span class="line"><span class="cl">  { &#34;username&#34;: &#34;ct8user1&#34;, &#34;password&#34;: &#34;ct8password1&#34;, &#34;type&#34;: &#34;ct8&#34; },
</span></span><span class="line"><span class="cl">  { &#34;username&#34;: &#34;ct8user2&#34;, &#34;password&#34;: &#34;ct8password2&#34;, &#34;type&#34;: &#34;ct8&#34; }
</span></span><span class="line"><span class="cl">]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>TELEGRAM_JSON</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;telegramBotToken&#34;: &#34;YOUR_BOT_TOKEN&#34;,
</span></span><span class="line"><span class="cl">  &#34;telegramBotUserId&#34;: &#34;YOUR_USER_ID&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://roim-picx-9nr.pages.dev/rest/RLqprLK.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>cron任务设置
<img src="https://roim-picx-9nr.pages.dev/rest/aBbQrLK.png"
	
	
	
	loading="lazy"
	
	
></li>
<li>然后就可以触发一下看能不能登录成功
<img src="https://roim-picx-9nr.pages.dev/rest/jl1QrLK.png"
	
	
	
	loading="lazy"
	
	
>
telegrame成功推送信息就ok了
<img src="https://roim-picx-9nr.pages.dev/rest/siiRrLK.png"
	
	
	
	loading="lazy"
	
	
></li>
</ul>
<h1 id="2进程保活">2.进程保活
</h1><ul>
<li>因为serv00会不定时清空进程和我们设置的cron任务，每次添加cron任务会很麻烦，便通过脚本一键添加cron任务。</li>
<li>wocker:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">addEventListener</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span> <span class="n">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">event</span><span class="o">.</span><span class="n">respondWith</span><span class="p">(</span><span class="n">handleRequest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">request</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">addEventListener</span><span class="p">(</span><span class="s1">&#39;scheduled&#39;</span><span class="p">,</span> <span class="n">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">event</span><span class="o">.</span><span class="n">waitUntil</span><span class="p">(</span><span class="n">handleScheduled</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scheduledTime</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">handleRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">url</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URL</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">pathname</span> <span class="o">===</span> <span class="s1">&#39;/login&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">===</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">formData</span> <span class="o">=</span> <span class="n">await</span> <span class="n">request</span><span class="o">.</span><span class="n">formData</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">password</span> <span class="o">=</span> <span class="n">formData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">password</span> <span class="o">===</span> <span class="n">PASSWORD</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">response</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span> <span class="n">success</span><span class="p">:</span> <span class="bp">true</span> <span class="p">}),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="err">`</span><span class="n">auth</span><span class="o">=$</span><span class="p">{</span><span class="n">PASSWORD</span><span class="p">};</span> <span class="n">HttpOnly</span><span class="p">;</span> <span class="n">Secure</span><span class="p">;</span> <span class="n">SameSite</span><span class="o">=</span><span class="n">Strict</span><span class="p">;</span> <span class="ne">Path</span><span class="o">=/</span><span class="p">;</span> <span class="n">Max</span><span class="o">-</span><span class="n">Age</span><span class="o">=</span><span class="mi">86400</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span> <span class="p">}),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">pathname</span> <span class="o">===</span> <span class="s1">&#39;/run&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">===</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isAuthenticated</span><span class="p">(</span><span class="n">request</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Unauthorized&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="n">status</span><span class="p">:</span> <span class="mi">401</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">await</span> <span class="n">handleScheduled</span><span class="p">(</span><span class="n">new</span> <span class="n">Date</span><span class="p">()</span><span class="o">.</span><span class="n">toISOString</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">results</span> <span class="o">=</span> <span class="n">await</span> <span class="n">CRON_RESULTS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lastResults&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">pathname</span> <span class="o">===</span> <span class="s1">&#39;/results&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">===</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isAuthenticated</span><span class="p">(</span><span class="n">request</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span> <span class="n">authenticated</span><span class="p">:</span> <span class="bp">false</span> <span class="p">}),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">results</span> <span class="o">=</span> <span class="n">await</span> <span class="n">CRON_RESULTS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lastResults&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span> <span class="n">authenticated</span><span class="p">:</span> <span class="bp">true</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">results</span> <span class="o">||</span> <span class="p">[]</span> <span class="p">}),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">pathname</span> <span class="o">===</span> <span class="s1">&#39;/check-auth&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">===</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span> <span class="n">authenticated</span><span class="p">:</span> <span class="n">isAuthenticated</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="p">}),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="err">显示登录页面或结果页面的</span> <span class="n">HTML</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">new</span> <span class="n">Response</span><span class="p">(</span><span class="n">getHtmlContent</span><span class="p">(),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html&#39;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">isAuthenticated</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cookie&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">cookies</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">authCookie</span> <span class="o">=</span> <span class="n">cookies</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">c</span> <span class="o">=&gt;</span> <span class="n">c</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span><span class="o">.</span><span class="n">startsWith</span><span class="p">(</span><span class="s1">&#39;auth=&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">authCookie</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">authValue</span> <span class="o">=</span> <span class="n">authCookie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">authValue</span> <span class="o">===</span> <span class="n">PASSWORD</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="bp">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">getHtmlContent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="err">`</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;viewport&#34;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Worker</span> <span class="ne">Control</span> <span class="ne">Panel</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">font</span><span class="o">-</span><span class="n">family</span><span class="p">:</span> <span class="n">Arial</span><span class="p">,</span> <span class="n">sans</span><span class="o">-</span><span class="n">serif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">justify</span><span class="o">-</span><span class="n">content</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">min</span><span class="o">-</span><span class="n">height</span><span class="p">:</span> <span class="mi">100</span><span class="n">vh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="c1">#f0f0f0;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">container</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">padding</span><span class="p">:</span> <span class="mi">20</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">border</span><span class="o">-</span><span class="n">radius</span><span class="p">:</span> <span class="mi">8</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">2</span><span class="n">px</span> <span class="mi">4</span><span class="n">px</span> <span class="n">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nb">max</span><span class="o">-</span><span class="n">width</span><span class="p">:</span> <span class="mi">800</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">input</span><span class="p">,</span> <span class="n">button</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">margin</span><span class="p">:</span> <span class="mi">10</span><span class="n">px</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">padding</span><span class="p">:</span> <span class="mi">10</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">width</span><span class="p">:</span> <span class="mi">200</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">border</span><span class="o">-</span><span class="n">radius</span><span class="p">:</span> <span class="mi">4</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">border</span><span class="p">:</span> <span class="mi">1</span><span class="n">px</span> <span class="n">solid</span> <span class="c1">#ddd;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">button</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="c1">#4CAF50;</span>
</span></span><span class="line"><span class="cl">        <span class="n">border</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">color</span><span class="p">:</span> <span class="n">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cursor</span><span class="p">:</span> <span class="n">pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#status {</span>
</span></span><span class="line"><span class="cl">        <span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span> <span class="mi">20</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">table</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">border</span><span class="o">-</span><span class="n">collapse</span><span class="p">:</span> <span class="n">collapse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span> <span class="mi">20</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">th</span><span class="p">,</span> <span class="n">td</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">border</span><span class="p">:</span> <span class="mi">1</span><span class="n">px</span> <span class="n">solid</span> <span class="c1">#ddd;</span>
</span></span><span class="line"><span class="cl">        <span class="n">padding</span><span class="p">:</span> <span class="mi">8</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">left</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">th</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="c1">#f2f2f2;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#loginForm, #dashboard {</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&#34;container&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Worker</span> <span class="ne">Control</span> <span class="ne">Panel</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="n">div</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;loginForm&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">&#34;password&#34;</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;password&#34;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&#34;Enter password&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">button</span> <span class="n">onclick</span><span class="o">=</span><span class="s2">&#34;login()&#34;</span><span class="o">&gt;</span><span class="n">Login</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="n">div</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;dashboard&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">button</span> <span class="n">onclick</span><span class="o">=</span><span class="s2">&#34;runScript()&#34;</span><span class="o">&gt;</span><span class="n">Run</span> <span class="ne">Script</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">div</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;status&#34;</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">table</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;resultsTable&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="n">thead</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Account</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Type</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Status</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Message</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Last</span> <span class="n">Run</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;/</span><span class="n">thead</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="n">tbody</span><span class="o">&gt;&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">let</span> <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">function</span> <span class="n">showLoginForm</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;loginForm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">function</span> <span class="n">showDashboard</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;loginForm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">fetchResults</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">async</span> <span class="n">function</span> <span class="n">checkAuth</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">response</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;/check-auth&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">data</span> <span class="o">=</span> <span class="n">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">authenticated</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">showDashboard</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">showLoginForm</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">async</span> <span class="n">function</span> <span class="n">login</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">formData</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FormData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">formData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">response</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">          <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">body</span><span class="p">:</span> <span class="n">formData</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">result</span> <span class="o">=</span> <span class="n">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">showDashboard</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">alert</span><span class="p">(</span><span class="s1">&#39;Incorrect password&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">async</span> <span class="n">function</span> <span class="n">runScript</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">statusDiv</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">statusDiv</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="s1">&#39;Executing script...&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">response</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;/run&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">const</span> <span class="n">results</span> <span class="o">=</span> <span class="n">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">displayResults</span><span class="p">(</span><span class="n">results</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">statusDiv</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="s1">&#39;Script executed successfully!&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">===</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">statusDiv</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="s1">&#39;Unauthorized. Please login again.&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">showLoginForm</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">statusDiv</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="s1">&#39;Error executing script.&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">statusDiv</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="s1">&#39;Error: &#39;</span> <span class="o">+</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">async</span> <span class="n">function</span> <span class="n">fetchResults</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">response</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;/results&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">const</span> <span class="n">data</span> <span class="o">=</span> <span class="n">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">authenticated</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">displayResults</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">results</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">showLoginForm</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Failed to fetch results&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">showLoginForm</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error fetching results:&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">showLoginForm</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">function</span> <span class="n">displayResults</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">tbody</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">querySelector</span><span class="p">(</span><span class="s1">&#39;#resultsTable tbody&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">tbody</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">result</span><span class="o">.</span><span class="n">cronResults</span><span class="o">.</span><span class="n">forEach</span><span class="p">((</span><span class="n">cronResult</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">const</span> <span class="n">row</span> <span class="o">=</span> <span class="n">tbody</span><span class="o">.</span><span class="n">insertRow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">row</span><span class="o">.</span><span class="n">insertCell</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">row</span><span class="o">.</span><span class="n">insertCell</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">row</span><span class="o">.</span><span class="n">insertCell</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">row</span><span class="o">.</span><span class="n">insertCell</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">row</span><span class="o">.</span><span class="n">insertCell</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="n">cronResult</span><span class="o">.</span><span class="n">success</span> <span class="err">?</span> <span class="s1">&#39;Success&#39;</span> <span class="p">:</span> <span class="s1">&#39;Failed&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">row</span><span class="o">.</span><span class="n">insertCell</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="n">cronResult</span><span class="o">.</span><span class="n">message</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">row</span><span class="o">.</span><span class="n">insertCell</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">textContent</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Date</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">lastRun</span><span class="p">)</span><span class="o">.</span><span class="n">toLocaleString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="err">页面加载时检查认证状态</span>
</span></span><span class="line"><span class="cl">      <span class="n">document</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="n">checkAuth</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">handleScheduled</span><span class="p">(</span><span class="n">scheduledTime</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">accountsData</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ACCOUNTS_JSON</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">accountsData</span><span class="o">.</span><span class="n">accounts</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">let</span> <span class="n">results</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">account</span> <span class="n">of</span> <span class="n">accounts</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">result</span> <span class="o">=</span> <span class="n">await</span> <span class="n">loginAccount</span><span class="p">(</span><span class="n">account</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">await</span> <span class="n">delay</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">8000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="o">//</span> <span class="err">保存结果到</span> <span class="n">KV</span> <span class="err">存储</span>
</span></span><span class="line"><span class="cl">  <span class="n">await</span> <span class="n">CRON_RESULTS</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;lastResults&#39;</span><span class="p">,</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">results</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">generateRandomUserAgent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">browsers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Chrome&#39;</span><span class="p">,</span> <span class="s1">&#39;Firefox&#39;</span><span class="p">,</span> <span class="s1">&#39;Safari&#39;</span><span class="p">,</span> <span class="s1">&#39;Edge&#39;</span><span class="p">,</span> <span class="s1">&#39;Opera&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">browser</span> <span class="o">=</span> <span class="n">browsers</span><span class="p">[</span><span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">browsers</span><span class="o">.</span><span class="n">length</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">version</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Windows NT 10.0&#39;</span><span class="p">,</span> <span class="s1">&#39;Macintosh&#39;</span><span class="p">,</span> <span class="s1">&#39;X11&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">selectedOS</span> <span class="o">=</span> <span class="n">os</span><span class="p">[</span><span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">os</span><span class="o">.</span><span class="n">length</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">osVersion</span> <span class="o">=</span> <span class="n">selectedOS</span> <span class="o">===</span> <span class="s1">&#39;X11&#39;</span> <span class="err">?</span> <span class="s1">&#39;Linux x86_64&#39;</span> <span class="p">:</span> <span class="n">selectedOS</span> <span class="o">===</span> <span class="s1">&#39;Macintosh&#39;</span> <span class="err">?</span> <span class="s1">&#39;Intel Mac OS X 10_15_7&#39;</span> <span class="p">:</span> <span class="s1">&#39;Win64; x64&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="err">`</span><span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">selectedOS</span><span class="p">};</span> <span class="o">$</span><span class="p">{</span><span class="n">osVersion</span><span class="p">})</span> <span class="n">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span> <span class="p">(</span><span class="n">KHTML</span><span class="p">,</span> <span class="n">like</span> <span class="n">Gecko</span><span class="p">)</span> <span class="o">$</span><span class="p">{</span><span class="n">browser</span><span class="p">}</span><span class="o">/$</span><span class="p">{</span><span class="n">version</span><span class="p">}</span><span class="o">.</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">0</span> <span class="n">Safari</span><span class="o">/</span><span class="mf">537.36</span><span class="err">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">loginAccount</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="p">{</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">panelnum</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">cronCommands</span> <span class="p">}</span> <span class="o">=</span> <span class="n">account</span>
</span></span><span class="line"><span class="cl">  <span class="n">let</span> <span class="n">baseUrl</span> <span class="o">=</span> <span class="n">type</span> <span class="o">===</span> <span class="s1">&#39;ct8&#39;</span> 
</span></span><span class="line"><span class="cl">    <span class="err">?</span> <span class="s1">&#39;https://panel.ct8.pl&#39;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">:</span> <span class="err">`</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">panel</span><span class="o">$</span><span class="p">{</span><span class="n">panelnum</span><span class="p">}</span><span class="o">.</span><span class="n">serv00</span><span class="o">.</span><span class="n">com</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">  <span class="n">let</span> <span class="n">loginUrl</span> <span class="o">=</span> <span class="err">`</span><span class="o">$</span><span class="p">{</span><span class="n">baseUrl</span><span class="p">}</span><span class="o">/</span><span class="n">login</span><span class="o">/</span><span class="err">?</span><span class="n">next</span><span class="o">=/</span><span class="n">cron</span><span class="o">/</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">userAgent</span> <span class="o">=</span> <span class="n">generateRandomUserAgent</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">response</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">loginUrl</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">pageContent</span> <span class="o">=</span> <span class="n">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">csrfMatch</span> <span class="o">=</span> <span class="n">pageContent</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="o">/</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;csrfmiddlewaretoken&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&#34;([^&#34;</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="s2">&#34;/)</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">csrfToken</span> <span class="o">=</span> <span class="n">csrfMatch</span> <span class="err">?</span> <span class="n">csrfMatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">csrfToken</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">throw</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;CSRF token not found&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">initialCookies</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set-cookie&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">formData</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URLSearchParams</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;csrfmiddlewaretoken&#39;</span><span class="p">:</span> <span class="n">csrfToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;next&#39;</span><span class="p">:</span> <span class="s1">&#39;/cron/&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">loginResponse</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">loginUrl</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="n">loginUrl</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="n">initialCookies</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="n">body</span><span class="p">:</span> <span class="n">formData</span><span class="o">.</span><span class="n">toString</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">      <span class="n">redirect</span><span class="p">:</span> <span class="s1">&#39;manual&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">loginResponse</span><span class="o">.</span><span class="n">status</span> <span class="o">===</span> <span class="mi">302</span> <span class="o">&amp;&amp;</span> <span class="n">loginResponse</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/cron/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">loginCookies</span> <span class="o">=</span> <span class="n">loginResponse</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set-cookie&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">allCookies</span> <span class="o">=</span> <span class="n">combineCookies</span><span class="p">(</span><span class="n">initialCookies</span><span class="p">,</span> <span class="n">loginCookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="err">访问</span> <span class="n">cron</span> <span class="err">列表页面</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">cronListUrl</span> <span class="o">=</span> <span class="err">`</span><span class="o">$</span><span class="p">{</span><span class="n">baseUrl</span><span class="p">}</span><span class="o">/</span><span class="n">cron</span><span class="o">/</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">cronListResponse</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">cronListUrl</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="n">allCookies</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">cronListContent</span> <span class="o">=</span> <span class="n">await</span> <span class="n">cronListResponse</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Cron</span> <span class="n">list</span> <span class="n">URL</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">cronListUrl</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Cron</span> <span class="n">list</span> <span class="n">response</span> <span class="n">status</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">cronListResponse</span><span class="o">.</span><span class="n">status</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Cron</span> <span class="n">list</span> <span class="n">content</span> <span class="p">(</span><span class="n">first</span> <span class="mi">1000</span> <span class="n">chars</span><span class="p">):</span> <span class="o">$</span><span class="p">{</span><span class="n">cronListContent</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)}</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">let</span> <span class="n">cronResults</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">cronCommand</span> <span class="n">of</span> <span class="n">cronCommands</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cronListContent</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="n">cronCommand</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="o">//</span> <span class="err">访问添加</span> <span class="n">cron</span> <span class="err">任务页面</span>
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">addCronUrl</span> <span class="o">=</span> <span class="err">`</span><span class="o">$</span><span class="p">{</span><span class="n">baseUrl</span><span class="p">}</span><span class="o">/</span><span class="n">cron</span><span class="o">/</span><span class="n">add</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">addCronPageResponse</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">addCronUrl</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="n">allCookies</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="n">cronListUrl</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">})</span>
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">addCronPageContent</span> <span class="o">=</span> <span class="n">await</span> <span class="n">addCronPageResponse</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Add</span> <span class="n">cron</span> <span class="n">page</span> <span class="n">URL</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">addCronUrl</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Add</span> <span class="n">cron</span> <span class="n">page</span> <span class="n">response</span> <span class="n">status</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">addCronPageResponse</span><span class="o">.</span><span class="n">status</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Add</span> <span class="n">cron</span> <span class="n">page</span> <span class="n">content</span> <span class="p">(</span><span class="n">first</span> <span class="mi">1000</span> <span class="n">chars</span><span class="p">):</span> <span class="o">$</span><span class="p">{</span><span class="n">addCronPageContent</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)}</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">newCsrfMatch</span> <span class="o">=</span> <span class="n">addCronPageContent</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="o">/</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;csrfmiddlewaretoken&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&#34;([^&#34;</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="s2">&#34;/)</span>
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">newCsrfToken</span> <span class="o">=</span> <span class="n">newCsrfMatch</span> <span class="err">?</span> <span class="n">newCsrfMatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">newCsrfToken</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">throw</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;New CSRF token not found for adding cron task&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">formData</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URLSearchParams</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;csrfmiddlewaretoken&#39;</span><span class="p">:</span> <span class="n">newCsrfToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;spec&#39;</span><span class="p">:</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;minute_time_interval&#39;</span><span class="p">:</span> <span class="s1">&#39;on&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;minute&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;hour_time_interval&#39;</span><span class="p">:</span> <span class="s1">&#39;each&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;hour&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;day_time_interval&#39;</span><span class="p">:</span> <span class="s1">&#39;each&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;month_time_interval&#39;</span><span class="p">:</span> <span class="s1">&#39;each&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;dow_time_interval&#39;</span><span class="p">:</span> <span class="s1">&#39;each&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;dow&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="n">cronCommand</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Auto added cron job&#39;</span>
</span></span><span class="line"><span class="cl">          <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Form data being sent:&#39;</span><span class="p">,</span> <span class="n">formData</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="p">{</span> <span class="n">success</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">addCronResponse</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">addCronResponseContent</span> <span class="p">}</span> <span class="o">=</span> <span class="n">await</span> <span class="n">addCronWithRetry</span><span class="p">(</span><span class="n">addCronUrl</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="n">allCookies</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="n">addCronUrl</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="n">baseUrl</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;en-US,en;q=0.5&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Upgrade-Insecure-Requests&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="n">body</span><span class="p">:</span> <span class="n">formData</span><span class="o">.</span><span class="n">toString</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">          <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Full response content:&#39;</span><span class="p">,</span> <span class="n">addCronResponseContent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">addCronResponseContent</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="s1">&#39;Cron job has been added&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="n">addCronResponseContent</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="s1">&#39;Zadanie cron zostało dodane&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`添加了新的</span> <span class="n">cron</span> <span class="err">任务：</span><span class="o">$</span><span class="p">{</span><span class="n">cronCommand</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="n">await</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="err">`账号</span> <span class="o">$</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">type</span><span class="p">})</span> <span class="o">$</span><span class="p">{</span><span class="n">message</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="n">cronResults</span><span class="o">.</span><span class="n">push</span><span class="p">({</span> <span class="n">success</span><span class="p">:</span> <span class="bp">true</span><span class="p">,</span> <span class="n">message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="o">//</span> <span class="err">如果响应中没有成功信息，再次检查</span><span class="n">cron列表</span>
</span></span><span class="line"><span class="cl">              <span class="k">const</span> <span class="n">checkCronListResponse</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">cronListUrl</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="n">allCookies</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">});</span>
</span></span><span class="line"><span class="cl">              <span class="k">const</span> <span class="n">checkCronListContent</span> <span class="o">=</span> <span class="n">await</span> <span class="n">checkCronListResponse</span><span class="o">.</span><span class="n">text</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">              
</span></span><span class="line"><span class="cl">              <span class="k">if</span> <span class="p">(</span><span class="n">checkCronListContent</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="n">cronCommand</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`确认添加了新的</span> <span class="n">cron</span> <span class="err">任务：</span><span class="o">$</span><span class="p">{</span><span class="n">cronCommand</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">await</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="err">`账号</span> <span class="o">$</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">type</span><span class="p">})</span> <span class="o">$</span><span class="p">{</span><span class="n">message</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">cronResults</span><span class="o">.</span><span class="n">push</span><span class="p">({</span> <span class="n">success</span><span class="p">:</span> <span class="bp">true</span><span class="p">,</span> <span class="n">message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`尝试添加</span> <span class="n">cron</span> <span class="err">任务：</span><span class="o">$</span><span class="p">{</span><span class="n">cronCommand</span><span class="p">}</span><span class="err">，但在列表中未找到。可能添加失败。`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">cronResults</span><span class="o">.</span><span class="n">push</span><span class="p">({</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span> <span class="n">message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`添加</span> <span class="n">cron</span> <span class="err">任务失败：</span><span class="o">$</span><span class="p">{</span><span class="n">cronCommand</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">cronResults</span><span class="o">.</span><span class="n">push</span><span class="p">({</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span> <span class="n">message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`</span><span class="n">cron</span> <span class="err">任务已存在：</span><span class="o">$</span><span class="p">{</span><span class="n">cronCommand</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">cronResults</span><span class="o">.</span><span class="n">push</span><span class="p">({</span> <span class="n">success</span><span class="p">:</span> <span class="bp">true</span><span class="p">,</span> <span class="n">message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span> <span class="n">username</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">cronResults</span><span class="p">,</span> <span class="n">lastRun</span><span class="p">:</span> <span class="n">new</span> <span class="n">Date</span><span class="p">()</span><span class="o">.</span><span class="n">toISOString</span><span class="p">()</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`登录失败，未知原因。请检查账号和密码是否正确。`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span> <span class="n">username</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">cronResults</span><span class="p">:</span> <span class="p">[{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span> <span class="n">message</span> <span class="p">}],</span> <span class="n">lastRun</span><span class="p">:</span> <span class="n">new</span> <span class="n">Date</span><span class="p">()</span><span class="o">.</span><span class="n">toISOString</span><span class="p">()</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">message</span> <span class="o">=</span> <span class="err">`登录或添加</span> <span class="n">cron</span> <span class="err">任务时出现错误</span><span class="p">:</span> <span class="o">$</span><span class="p">{</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span> <span class="n">username</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">cronResults</span><span class="p">:</span> <span class="p">[{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span> <span class="n">message</span> <span class="p">}],</span> <span class="n">lastRun</span><span class="p">:</span> <span class="n">new</span> <span class="n">Date</span><span class="p">()</span><span class="o">.</span><span class="n">toISOString</span><span class="p">()</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">addCronWithRetry</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">maxRetries</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">maxRetries</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">response</span> <span class="o">=</span> <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">responseContent</span> <span class="o">=</span> <span class="n">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Attempt</span> <span class="o">$</span><span class="p">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="n">response</span> <span class="n">status</span><span class="p">:</span><span class="err">`</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Attempt</span> <span class="o">$</span><span class="p">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="n">response</span> <span class="n">content</span> <span class="p">(</span><span class="n">first</span> <span class="mi">1000</span> <span class="n">chars</span><span class="p">):</span><span class="err">`</span><span class="p">,</span> <span class="n">responseContent</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">===</span> <span class="mi">200</span> <span class="o">||</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">===</span> <span class="mi">302</span> <span class="o">||</span> <span class="n">responseContent</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="s1">&#39;Cron job has been added&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="n">responseContent</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="s1">&#39;Zadanie cron zostało dodane&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">true</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">responseContent</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="err">`</span><span class="n">Attempt</span> <span class="o">$</span><span class="p">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="n">failed</span><span class="p">:</span><span class="err">`</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">await</span> <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="o">//</span> <span class="n">Wait</span> <span class="mi">2</span> <span class="n">seconds</span> <span class="n">before</span> <span class="n">retrying</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="n">success</span><span class="p">:</span> <span class="bp">false</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">combineCookies</span><span class="p">(</span><span class="n">cookies1</span><span class="p">,</span> <span class="n">cookies2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">cookieMap</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Map</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">parseCookies</span> <span class="o">=</span> <span class="p">(</span><span class="n">cookieString</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookieString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">cookie</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="p">[</span><span class="n">fullCookie</span><span class="p">]</span> <span class="o">=</span> <span class="n">cookie</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullCookie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cookieMap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">trim</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">trim</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">parseCookies</span><span class="p">(</span><span class="n">cookies1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">parseCookies</span><span class="p">(</span><span class="n">cookies2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="ne">Array</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">cookieMap</span><span class="o">.</span><span class="n">entries</span><span class="p">())</span><span class="o">.</span><span class="n">map</span><span class="p">(([</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="err">`</span><span class="o">$</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="o">=$</span><span class="p">{</span><span class="n">value</span><span class="p">}</span><span class="err">`</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">sendTelegramMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">telegramConfig</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">TELEGRAM_JSON</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="p">{</span> <span class="n">telegramBotToken</span><span class="p">,</span> <span class="n">telegramBotUserId</span> <span class="p">}</span> <span class="o">=</span> <span class="n">telegramConfig</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">url</span> <span class="o">=</span> <span class="err">`</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">telegram</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">bot</span><span class="o">$</span><span class="p">{</span><span class="n">telegramBotToken</span><span class="p">}</span><span class="o">/</span><span class="n">sendMessage</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="n">body</span><span class="p">:</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="n">chat_id</span><span class="p">:</span> <span class="n">telegramBotUserId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span><span class="p">:</span> <span class="n">message</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error sending Telegram message:&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">delay</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">new</span> <span class="n">Promise</span><span class="p">(</span><span class="n">resolve</span> <span class="o">=&gt;</span> <span class="n">setTimeout</span><span class="p">(</span><span class="n">resolve</span><span class="p">,</span> <span class="n">ms</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ACCOUNTS_JSON</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;accounts&#34;: [
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;username&#34;: &#34;user1&#34;,
</span></span><span class="line"><span class="cl">      &#34;password&#34;: &#34;password1&#34;,
</span></span><span class="line"><span class="cl">      &#34;type&#34;: &#34;ct8&#34;,
</span></span><span class="line"><span class="cl">      &#34;cronCommands&#34;: [
</span></span><span class="line"><span class="cl">        &#34;/usr/home/serv00name/domains&#34;,
</span></span><span class="line"><span class="cl">        &#34;你的脚本&#34;
</span></span><span class="line"><span class="cl">      ]
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;username&#34;: &#34;user2&#34;,
</span></span><span class="line"><span class="cl">      &#34;password&#34;: &#34;password2&#34;,
</span></span><span class="line"><span class="cl">      &#34;panelnum&#34;: &#34;2&#34;,
</span></span><span class="line"><span class="cl">      &#34;type&#34;: &#34;serv00&#34;,
</span></span><span class="line"><span class="cl">      &#34;cronCommands&#34;: [
</span></span><span class="line"><span class="cl">        &#34;/usr/home/serv00name&#34;
</span></span><span class="line"><span class="cl">      ]
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;username&#34;: &#34;user3&#34;,
</span></span><span class="line"><span class="cl">      &#34;password&#34;: &#34;password3&#34;,
</span></span><span class="line"><span class="cl">      &#34;type&#34;: &#34;ct8&#34;,
</span></span><span class="line"><span class="cl">      &#34;cronCommands&#34;: [
</span></span><span class="line"><span class="cl">        &#34;/usr/home/serv00name&#34;,
</span></span><span class="line"><span class="cl">        &#34;你的脚本&#34;,
</span></span><span class="line"><span class="cl">        &#34;python /usr/home/serv00name/domains/backup.py&#34;
</span></span><span class="line"><span class="cl">      ]
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  ]
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>TELEGRAM_JSON</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;telegramBotToken&#34;: &#34;YOUR_BOT_TOKEN&#34;,
</span></span><span class="line"><span class="cl">  &#34;telegramBotUserId&#34;: &#34;YOUR_USER_ID&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>PASSWORD</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">你访问worker面板的密码
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>添加Cron
<img src="https://roim-picx-9nr.pages.dev/rest/Z0krrLK.png"
	
	
	
	loading="lazy"
	
	
></li>
<li>创建一个名为CRON_RESULTS的KV变量</li>
<li>回到刚才创建的worker界面绑定KV
<img src="https://roim-picx-9nr.pages.dev/rest/xpzrrLK.png"
	
	
	
	loading="lazy"
	
	
></li>
<li>访问你的worker网站并输入密码,点击运行脚本即可。
<img src="https://roim-picx-9nr.pages.dev/rest/opJqrLK.png"
	
	
	
	loading="lazy"
	
	
>
参考：
<a class="link" href="https://linux.do/t/topic/181957"  target="_blank" rel="noopener"
    >https://linux.do/t/topic/181957</a></li>
</ul>

</section>


    <footer class="article-footer">
    

    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Dec 12, 2024 10:37 UTC
        </span>
    </section></footer>


    
</article>

    

    

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://vercelcomment-one.vercel.app/"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 faust
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

<meting-js
	server="netease"
	type="playlist"
	id="12928958918"
	fixed="true"
	volume="0.5"
	>

</meting-js>



<script>
    
    pjax._handleResponse = pjax.handleResponse;
    pjax.handleResponse = function(responseText, request, href, options) {
        if (request.responseText.match("<html")) {
            
            let newDom = new DOMParser().parseFromString(responseText, 'text/html');
            
            let bodyClass = newDom.body.className;
            document.body.setAttribute("class", bodyClass)
            
            pjax._handleResponse(responseText, request, href, options);
        } else {
            
        }
    }
</script>


<script>
    
    document.addEventListener('pjax:complete', () => {
        
        window.Stack.init();
    })
</script>

    </body>
</html>
